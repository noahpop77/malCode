IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoKaW1wb3J0IG9zLCBzeXMsIHBhcmFtaWtvCmltcG9ydCBz
aWduYWwKaW1wb3J0IGVycm5vCmltcG9ydCBhdGV4aXQKaW1wb3J0IHNvY2tldAojZnJvbSBzb2Nr
ZXQgaW1wb3J0ICoKZnJvbSBsb2d6ZXJvIGltcG9ydCBsb2dnZXIKaW1wb3J0IHRpbWUKaW1wb3J0
IHN1YnByb2Nlc3MKaW1wb3J0IHRraW50ZXIKaW1wb3J0IGJhc2U2NAppbXBvcnQgcmVxdWVzdHMK
CgoKIyBGdW5jdGlvbiB0byBkYWVtb25pemUgY29kZQpkZWYgZGFlbW9uaXplKHNlbGYpOgogICAg
dHJ5OgogICAgICAgICAgICBwaWQgPSBvcy5mb3JrKCkKICAgICAgICAgICAgaWYgcGlkID4gMDoK
ICAgICAgICAgICAgICAgICAgICAjIGV4aXQgZmlyc3QgcGFyZW50CiAgICAgICAgICAgICAgICAg
ICAgc3lzLmV4aXQoMCkKICAgIGV4Y2VwdCBPU0Vycm9yIGFzIGU6CiAgICAgICAgICAgIHN5cy5z
dGRlcnIud3JpdGUoImZvcmsgIzEgZmFpbGVkOiAlZCAoJXMpXG4iICUgKGUuZXJybm8sIGUuc3Ry
ZXJyb3IpKQogICAgICAgICAgICBzeXMuZXhpdCgxKQoKICAgICMgZGVjb3VwbGUgZnJvbSBwYXJl
bnQgZW52aXJvbm1lbnQKICAgIG9zLmNoZGlyKCIvdG1wLyIpCiAgICBvcy5zZXRzaWQoKQogICAg
b3MudW1hc2soMCkKCiAgICAjIGRvIHNlY29uZCBmb3JrCiAgICB0cnk6CiAgICAgICAgICAgIHBp
ZCA9IG9zLmZvcmsoKQogICAgICAgICAgICBpZiBwaWQgPiAwOgogICAgICAgICAgICAgICAgICAg
ICMgZXhpdCBmcm9tIHNlY29uZCBwYXJlbnQKICAgICAgICAgICAgICAgICAgICBzeXMuZXhpdCgw
KQogICAgZXhjZXB0IE9TRXJyb3IgYXMgZToKICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZSgi
Zm9yayAjMiBmYWlsZWQ6ICVkICglcylcbiIgJSAoZS5lcnJubywgZS5zdHJlcnJvcikpCiAgICAg
ICAgICAgIHN5cy5leGl0KDEpCgogICAgIyByZWRpcmVjdCBzdGFuZGFyZCBmaWxlIGRlc2NyaXB0
b3JzCiAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgIHN5cy5zdGRlcnIuZmx1c2goKQoKICAgIHNp
ID0gZmlsZShzZWxmLnN0ZGluLCAncicpCiAgICBzbyA9IGZpbGUoc2VsZi5zdGRvdXQsICdhKycp
CiAgICBzZSA9IGZpbGUoc2VsZi5zdGRlcnIsICdhKycsIDApCgogICAgb3MuZHVwMihzaS5maWxl
bm8oKSwgc3lzLnN0ZGluLmZpbGVubygpKQogICAgb3MuZHVwMihzby5maWxlbm8oKSwgc3lzLnN0
ZG91dC5maWxlbm8oKSkKICAgIG9zLmR1cDIoc2UuZmlsZW5vKCksIHN5cy5zdGRlcnIuZmlsZW5v
KCkpCgogICAgIyB3cml0ZSBwaWRmaWxlCiAgICBhdGV4aXQucmVnaXN0ZXIoc2VsZi5kZWxwaWQp
CiAgICBmaWxlKHNlbGYucGlkZmlsZSwndysnKS53cml0ZSgiJXNcbiIgJSBwaWQpCgojIEZ1bmN0
aW9uIHRvIGRhZW1vbml6ZSBjb2RlCmRlZiBzZWNvbmREYWVtb24oc2VsZik6CiAgICB0cnk6CiAg
ICAgICAgICAgIHBpZCA9IG9zLmZvcmsoKQogICAgICAgICAgICBpZiBwaWQgPiAwOgogICAgICAg
ICAgICAgICAgICAgICMgZXhpdCBmaXJzdCBwYXJlbnQKICAgICAgICAgICAgICAgICAgICBzeXMu
ZXhpdCgwKQogICAgZXhjZXB0IE9TRXJyb3IgYXMgZToKICAgICAgICAgICAgc3lzLnN0ZGVyci53
cml0ZSgiZm9yayAjMSBmYWlsZWQ6ICVkICglcylcbiIgJSAoZS5lcnJubywgZS5zdHJlcnJvcikp
CiAgICAgICAgICAgIHN5cy5leGl0KDEpCgogICAgIyBkZWNvdXBsZSBmcm9tIHBhcmVudCBlbnZp
cm9ubWVudAogICAgb3MuY2hkaXIoIi90bXAvIikKICAgIG9zLnNldHNpZCgpCiAgICBvcy51bWFz
aygwKQoKICAgICMgZG8gc2Vjb25kIGZvcmsKICAgIHRyeToKICAgICAgICAgICAgcGlkID0gb3Mu
Zm9yaygpCiAgICAgICAgICAgIGlmIHBpZCA+IDA6CiAgICAgICAgICAgICAgICAgICAgIyBleGl0
IGZyb20gc2Vjb25kIHBhcmVudAogICAgICAgICAgICAgICAgICAgIHN5cy5leGl0KDApCiAgICBl
eGNlcHQgT1NFcnJvciBhcyBlOgogICAgICAgICAgICBzeXMuc3RkZXJyLndyaXRlKCJmb3JrICMy
IGZhaWxlZDogJWQgKCVzKVxuIiAlIChlLmVycm5vLCBlLnN0cmVycm9yKSkKICAgICAgICAgICAg
c3lzLmV4aXQoMSkKCiAgICAjIHJlZGlyZWN0IHN0YW5kYXJkIGZpbGUgZGVzY3JpcHRvcnMKICAg
IHN5cy5zdGRvdXQuZmx1c2goKQogICAgc3lzLnN0ZGVyci5mbHVzaCgpCgogICAgc2kgPSBmaWxl
KHNlbGYuc3RkaW4sICdyJykKICAgIHNvID0gZmlsZShzZWxmLnN0ZG91dCwgJ2ErJykKICAgIHNl
ID0gZmlsZShzZWxmLnN0ZGVyciwgJ2ErJywgMCkKCiAgICBvcy5kdXAyKHNpLmZpbGVubygpLCBz
eXMuc3RkaW4uZmlsZW5vKCkpCiAgICBvcy5kdXAyKHNvLmZpbGVubygpLCBzeXMuc3Rkb3V0LmZp
bGVubygpKQogICAgb3MuZHVwMihzZS5maWxlbm8oKSwgc3lzLnN0ZGVyci5maWxlbm8oKSkKCiAg
ICAjIHdyaXRlIHBpZGZpbGUKICAgIGF0ZXhpdC5yZWdpc3RlcihzZWxmLmRlbHBpZCkKICAgIGZp
bGUoc2VsZi5waWRmaWxlLCd3KycpLndyaXRlKCIlc1xuIiAlIHBpZCkKCmRlZiByZXZUQ1AoKToK
ICAgICAgICAjIE1haW4gbG9vcCBmb3IgcmV2ZXJzZSBUQ1AgY29ubmVjdGlvbgogICAgICAgIHdo
aWxlIFRydWU6CiAgICAgICAgIyBBY2NlcHRzIHRoZSBpbmNvbWluZyBjb25uZWN0aW9uIG9uY2Ug
b25lIGlzIGVuZGVkCiAgICAgICAgIyBTb2NrZXQgZ2V0cyBkZWNsYXJlZAogICAgICAgICMgQ3Jl
YXRlcyBzb2NrZXQgY29ubmVjdGlvbgogICAgICAgICAgICAgICAgbXlTb2NrZXQgPSBzb2NrZXQu
c29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgICAg
ICBteVNvY2tldC5zZXRzb2Nrb3B0KHNvY2tldC5TT0xfU09DS0VULHNvY2tldC5TT19SRVVTRUFE
RFIsMSkKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIG15U29j
a2V0LmNvbm5lY3QoKCcxMjcuMC4wLjEnLDEyMzQpKQogICAgICAgICAgICAgICAgZXhjZXB0Ogog
ICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICNjb21tYW5kT3V0LmFwcGVuZChz
dWJwcm9jZXNzLmNoZWNrX291dHB1dChbJ2xzJywgJy1sJ10pKQogICAgICAgICNjb21tYW5kT3V0
LmFwcGVuZChzdWJwcm9jZXNzLmNoZWNrX291dHB1dChbJ3dob2FtaSddKSkKICAgICAgICAjY29t
bWFuZE91dC5hcHBlbmQoc3VicHJvY2Vzcy5jaGVja19vdXRwdXQoWydpZmNvbmZpZyddKSkKICAg
ICAgICAjI2NvbW1hbmRPdXQgPSBbXQogICAgICAgICMjIyBDb21tYW5kIGkgd2FudCB0byBleGVj
dXRlIHdpbGwgcnVuIGFuZCByZXR1cm4vc2VuZCB0aGUgb3V0cHV0IG9mIHRoYXQgY29tbWFuZCB0
byBteSBjYXRjaCBzZXJ2ZXIuCiAgICAgICAgIyNjb21tYW5kT3V0LmFwcGVuZChzdWJwcm9jZXNz
LmNoZWNrX291dHB1dChbJ3dob2FtaSddKSkKICAgICAgICAjI215U29ja2V0LnNlbmQoZiJ7Y29t
bWFuZE91dH0iLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAg
ICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBjb21tYW5kID0gbXlTb2NrZXQucmVjdigxMDI0KS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpZiBjb21tYW5kID09ICdxJzoKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG15U29ja2V0LmNsb3NlKCkKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHN5cy5leGl0KDApCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHByb2MgPSBzdWJwcm9jZXNzLlBvcGVuKGNvbW1hbmQsIHNoZWxsPVRydWUsIHN0ZG91dD1zdWJw
cm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsIHN0ZGluPXN1YnByb2Nlc3MuUElQ
RSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHByb2Mu
c3Rkb3V0LnJlYWQoKSArIHByb2Muc3RkZXJyLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbXlTb2NrZXQuc2VuZChzdHIob3V0cHV0KS5lbmNvZGUoJ3V0Zi04
JykpCiAgICAgICAgICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAg
ICAgICAgICAgICAgIG15U29ja2V0LmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgc3lz
LmV4aXQoMCkKICAgICAgICAgICAgICAgIG15U29ja2V0LmNsb3NlKCkKCnNlY29uZERhZW1vbgoK
d2hpbGUgVHJ1ZToKICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgdXJsID0gImh0dHBzOi8v
cmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9ub2FocG9wNzcvbWFsQ29kZS9tYXN0ZXIvY29uLnR4
dCIKICAgICAgICByZXEgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgICAgICNwcmludChyZXEudGV4
dCkKICAgICAgICBpZiByZXEudGV4dCA9PSAiMVxuIjoKICAgICAgICAgICAgICAgIHJldlRDUCgp
CiAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBhc3MKc3lzLmV4aXQoMCk=
